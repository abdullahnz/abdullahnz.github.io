<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
  <title>HTB: Overgraph - Binary Exploitation Part | Abdullah</title>
  <meta name="generator" content="Jekyll v4.3.2" />
  <meta property="og:title" content="HTB: Overgraph - Binary Exploitation Part" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="/2022/07/19/htb-overgraph-pwn-part.html" />
  <meta property="og:url" content="/2022/07/19/htb-overgraph-pwn-part.html" />
  <meta property="og:site_name" content="Abdullah" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2020-08-07T15:57:28+07:00" />
  <meta name="twitter:card" content="summary" />
  <meta property="twitter:title" content="HTB: Overgraph - Binary Exploitation Part" />

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "dateModified": "2020-08-07T15:57:28+07:00",
      "datePublished": "2020-08-07T15:57:28+07:00",
      "headline": "HTB: Overgraph - Binary Exploitation Part",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/2022/07/19/htb-overgraph-pwn-part.html"
      },
      "url": "/2022/07/19/htb-overgraph-pwn-part.html"
    }
  </script>
  <!-- End Jekyll SEO tag -->
  <link rel="stylesheet" href="/assets/main.custom.css" />
  <link
    type="application/atom+xml"
    rel="alternate"
    href="http://localhost:4000/feed.xml"
    title="HTB: Overgraph - Binary Exploitation Part"
  />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Abdullah</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">HTB: Overgraph - Binary Exploitation Part</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-07-19T15:57:28+07:00" itemprop="datePublished">Jul 19, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="0x01-overview">0x01 Overview</h2>

<p>Beberapa minggu yang lalu, aku diminta untuk mengerjakan soal pwn pentest dari machine yang terdapat pada <a href="http://www.hackthebox.com/">HackTheBox</a> oleh temanku. Karena ada waktu buat bantu ngerjain maka aku coba soalnya. Dan karena machine-nya memiliki kategori <code class="language-plaintext highlighter-rouge">hard</code> jadi disuruh juga buat writeupnya.</p>

<p>Binary merupakan ELF 64-bit dan running di mesin <code class="language-plaintext highlighter-rouge">ubuntu</code> dengan libc version <code class="language-plaintext highlighter-rouge">2.25</code> yang digunakan untuk membuat report suatu pesan. Report ini akan menulis pesan ke <code class="language-plaintext highlighter-rouge">/opt/crv/&lt;name&gt;</code>.</p>

<p>Berikut contoh tampilan program,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./nreport
Custom Reporting v1

Enter Your Token: &lt;SOME_VALID_TOKEN&gt;
Enter Name: &lt;NAME&gt;

Welcome &lt;NAME&gt;
1.Create New Message
2.Delete a Message
3.Edit Messages
4.Report All Messages
5.Exit
&gt;
</code></pre></div></div>

<h2 id="0x02-reversing-the-binary">0x02 Reversing the Binary</h2>

<p>Binary tidak memiliki fungsi-fungsi yang rumit, sehingga dapat dengan mudah untuk di-reversing.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Custom Reporting v1</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">auth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">token</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Welcome %s"</span><span class="p">,</span> <span class="n">userinfo1</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">1.Create New Message</span><span class="se">\n</span><span class="s">2.Delete a Message</span><span class="se">\n</span><span class="s">3.Edit Messages</span><span class="se">\n</span><span class="s">4.Report All Messages</span><span class="se">\n</span><span class="s">5.Exit"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"&gt; "</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">" %1[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">choice</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="token-authentication">Token Authentication</h3>

<p>Pengecekan token input dari user terdapat pada fungsi <code class="language-plaintext highlighter-rouge">auth</code> yang terdapat pada binary. Berikut hasil dekompilasi fungsi <code class="language-plaintext highlighter-rouge">auth</code> yang sudah dirapikan.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Enter Your Token: "</span><span class="p">);</span>
<span class="n">fgets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">token</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="o">&amp;</span><span class="n">token</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">15</span> <span class="p">)</span>
    <span class="k">goto</span> <span class="n">INVALID_TOKEN</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span> <span class="p">)</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">^</span> <span class="n">token</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">^</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">token</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">^</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

<span class="k">if</span> <span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">308</span><span class="p">)</span>
    <span class="k">goto</span> <span class="n">INVALID_TOKEN</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">325</span><span class="p">)</span>
    <span class="k">goto</span> <span class="n">INVALID_TOKEN</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">hash</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">265</span><span class="p">)</span>
    <span class="k">goto</span> <span class="n">INVALID_TOKEN</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Enter Name: "</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
<span class="n">scanf</span><span class="p">(</span><span class="s">" %39[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">userinfo1</span><span class="p">);</span>
<span class="p">...</span>
</code></pre></div></div>

<p>Seharusnya alur pengecekan token sudah lebih jelas untuk mendapatkan token yang valid,</p>

<ul>
  <li>Token harus memiliki panjang 15 karakter.</li>
  <li>Nilai <code class="language-plaintext highlighter-rouge">hash</code> merupakan hasil xor antara beberapa byte dari token dan <code class="language-plaintext highlighter-rouge">secret[i]</code> dengan nilai <code class="language-plaintext highlighter-rouge">i</code> yang selaras dengan index dari <code class="language-plaintext highlighter-rouge">hash</code>.</li>
  <li>Nilai dari beberapa <code class="language-plaintext highlighter-rouge">hash</code> merupakan nilai yang digunakan untuk pengecekan token yang valid.</li>
  <li>Jika pengecekan token lolos, maka akan ada inputan name yang akan disimpan pada <code class="language-plaintext highlighter-rouge">userinfo1</code>, dan jika gagal maka program akan exit.</li>
</ul>

<p>dah.</p>

<h3 id="generating-token-authentication">Generating Token Authentication</h3>

<p>Token dapat mudah digenerate dengan <code class="language-plaintext highlighter-rouge">z3</code> algebra-solver.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">z3</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># secret didapatkan pada binary.
</span><span class="n">secret</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>
    <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span>
    <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span>
    <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="nc">Solver</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="nc">BitVec</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">t!</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">And</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mh">0x61</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mh">0x7a</span><span class="p">))</span>

<span class="n">xored</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
    <span class="n">xored</span> <span class="o">^=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">((</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">308</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">((</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">7</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">8</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span> <span class="mi">9</span><span class="p">])</span> <span class="o">==</span> <span class="mi">325</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">((</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">xored</span> <span class="o">^</span> <span class="n">secret</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span> <span class="o">==</span> <span class="mi">265</span><span class="p">)</span>

<span class="k">while</span> <span class="n">s</span><span class="p">.</span><span class="nf">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">sat</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">model</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
        <span class="n">s</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Or</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>

    <span class="n">token</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="nf">chr</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">as_long</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">])</span>
    <span class="n">token</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">token</span><span class="p">[</span><span class="si">:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s">______</span><span class="si">{</span><span class="n">token</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s">___</span><span class="si">{</span><span class="n">token</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</code></pre></div></div>

<p>Jalankan dan akan mendapatkan banyak token yang bisa digunakan.</p>

<h3 id="where-is-the-bug">Where is the bug?</h3>

<p>Bug terdapat pada fungsi <code class="language-plaintext highlighter-rouge">edit</code>. Dimana index dari <code class="language-plaintext highlighter-rouge">message</code> yang akan di-edit tidak memiliki batas. Hal ini dapat menyebabkan index out-of-bound. Kita bisa mengedit pointer yang ada disebelum maupun sesudah <code class="language-plaintext highlighter-rouge">message_array</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span> <span class="n">Arryindex</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter number to edit: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%d[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">index</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Message Title: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">" %59[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">message_array</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span> <span class="c1">// oob jika 0 &lt; index &gt; 10</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Message: "</span><span class="p">);</span>
    <span class="n">message_content_ptr</span> <span class="o">=</span> <span class="n">message_array</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%100[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">message_content_ptr</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Sebagai gambaran, bersebelahannya variabel <code class="language-plaintext highlighter-rouge">message_array</code> dan <code class="language-plaintext highlighter-rouge">userinfo1</code>.</p>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>message_array[0]</strong></td>
      <td>0x4072c0</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
    </tr>
    <tr>
      <td><strong>message_array[9]</strong></td>
      <td>0x00000000</td>
    </tr>
    <tr>
      <td>…</td>
      <td>0x00000000</td>
    </tr>
    <tr>
      <td>…</td>
      <td>0x00000000</td>
    </tr>
    <tr>
      <td><strong>userinfo1</strong></td>
      <td>“somename”</td>
    </tr>
  </tbody>
</table>

<p>Bagaimana jika <code class="language-plaintext highlighter-rouge">userinfo1</code> yang menyimpan inputan name kita berisi suatu alamat memori? dan kita mengedit message pada index 12? Maka nilai yang berada pada alamat tersebutlah yang akan diedit.</p>

<h3 id="got-hijacking">GOT Hijacking</h3>

<p>Proteksi yang terdapat pada binary.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE <span class="o">(</span>0x3fd000<span class="o">)</span>
RUNPATH:  b<span class="s1">'/usr/local/bin/Nreport/libc/'</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">RELRO</code> ini adalah suatu proteksi yang membuat suatu section pada binary menjadi read-only. Proteksi ini ada 2 mode: full dan partial.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Full</code> berarti GOT section memiliki permission read-only,</li>
  <li><code class="language-plaintext highlighter-rouge">Partial</code> berarti GOT section memiliki permission writeable.</li>
</ul>

<p>Untuk lainnya, cari sendiri :lol:</p>

<p>Karena binary memiliki address yang tetap (No PIE), artinya kita bisa mendapatkan alamat suatu simbol dari entry got dengan mudah. Dalam kasus ini, kita akan mengoverwrite <code class="language-plaintext highlighter-rouge">free@got</code> ke system. Dan melakukan free atau delete message yang mengandung string <code class="language-plaintext highlighter-rouge">"/bin/sh"</code> untuk mendapatkan shell.</p>

<h3 id="exploit">Exploit</h3>

<p>Karena buffering enabled, maka disini aku hanya tuliskan alur exploitnya saja. Dan karena binary di-mesin memiliki setuid <code class="language-plaintext highlighter-rouge">root</code>, maka kita akan mendapatan <code class="language-plaintext highlighter-rouge">root</code>.</p>

<ol>
  <li>Input valid token yang sudah didapat.</li>
  <li>Input name dengan alamat dari <code class="language-plaintext highlighter-rouge">free@got</code> yaitu <code class="language-plaintext highlighter-rouge">0x404018</code>.</li>
  <li>Create new message dengan dengan title dan content <code class="language-plaintext highlighter-rouge">"/bin/sh"</code>.</li>
  <li>Edit index 12 (OOB) yang akan menunjuk ke buffer name kita yang berisi alamat dari <code class="language-plaintext highlighter-rouge">free@got</code>, menjadi <code class="language-plaintext highlighter-rouge">system@plt</code> pada <code class="language-plaintext highlighter-rouge">0x401080</code>.</li>
  <li>Delete message index 0 tadi yang menyimpan string <code class="language-plaintext highlighter-rouge">"/bin/sh"</code> untuk men-trigger <code class="language-plaintext highlighter-rouge">free</code>.</li>
  <li>Root shell!</li>
</ol>

  </div><a class="u-url" href="/2022/07/19/htb-overgraph-pwn-part.html" hidden></a>
</article>

      </div>
    </main></body>

</html>
